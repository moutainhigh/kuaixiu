<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- <script src="js/flexible.js"></script> -->
    <link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/addPricePoster.css">
    <title></title>
    <style>
        html {
            font-size: 16px;
        }

        .discount-wrap {
            padding: 1.25rem 1.4375rem;
            background: -webkit-linear-gradient(right top, #ffae00 , #ffbd00); /* Safari 5.1 - 6.0 */
            background: -o-linear-gradient(bottom left, #ffae00, #ffbd00); /* Opera 11.1 - 12.0 */
            background: -moz-linear-gradient(bottom left, #ffae00, #ffbd00); /* Firefox 3.6 - 15 */
            background: linear-gradient(to bottom left, #ffae00 , #ffbd00); /* 标准的语法 */
        }

        .discount-head img {
            width: 100vw;
            margin-left: -1.4375rem;
            margin-bottom: 1.25rem
        }

        .discount-coupon-item {
            width: 100%;
            height: 8.4375rem;
            border-radius: 0.5rem;
            margin-bottom: 0.9375rem;
            overflow: hidden;
            position: relative;
        }

        .d-item-top {
            width: 100%;
            height: 8.4375rem;
            background: url(./img/discount_bg_top.png) no-repeat;
            background-size: 100%;
            position: relative;
            overflow: hidden;
        }

        .d-item-top .item-main-price {
            float: left;
            font-size: 3.625rem;
            color: #fff;
            padding: 1.75rem 0 0 0.625rem;
        }

        .d-item-top .item-main-req {
            position: relative;
            float: left;
            color: #fff;
            font-size: 1rem;
            padding-top: 4.25rem;
        }

        .d-item-top .item-main-req .icon-ticket {
            position: absolute;
            width: 1rem;
            height: 2.5rem;
            top: 1.25rem;
            left: 0.3125rem;
        }

        .d-item-top .item-main-btn {
            position: absolute;
            top: 1.5625rem;
            right: 1.25rem;
            display: block;
            text-decoration: none;
            border-radius: 1.875rem;
            padding: 0.5rem 0.375rem;
            color: #f70830;
            font-size: 0.875rem;
            font-weight: 700;
            background: -webkit-linear-gradient(right top, #ffea7e , #f8b300); /* Safari 5.1 - 6.0 */
            background: -o-linear-gradient(bottom left, #ffea7e, #f8b300); /* Opera 11.1 - 12.0 */
            background: -moz-linear-gradient(bottom left, #ffea7e, #f8b300); /* Firefox 3.6 - 15 */
            background: linear-gradient(to bottom left, #ffea7e , #f8b300); /* 标准的语法 */
        }

        .d-item-bot {
            width: 100%;
            height: 2.3125rem;
            background: url(./img/discount_bg.png);
            
            font-size: 0.75rem;
            line-height: 2.75rem;
            color: #ccc;
            padding-left: 0.6875rem;

            position: absolute;
            left: 0;
            bottom: 0;
        }

        .feet-title {
            color: #ac1d00;
            font-size: 1.375rem;
            font-weight: 600;
            margin-bottom: 0.625rem;
            display: block;
        }

        .feet-rules {
            margin-left: 1.125rem;
        }

        .feet-rules li {
            list-style: decimal;
            color: #585858;
            font-size: 0.875rem;
            line-height: 1.375rem;
        }

        .d-item-top .disabled {
            display: none;
            border: 1px #fff dashed!important;
            color: #fff!important;
            background: none!important;
        }

    </style>
</head>
<body>
    <div id="wrap" class="discount-wrap">
 
        <div class="discount-head">
            <img src="./img/discount_head.png" alt="">
        </div>

        <ul id="ticket-box" class="discount-coupon">
          <!-- <li class="discount-coupon-item">
                <div class="d-item-top">
                    <div class="item-main-price">
                        <span>20</span>
                    </div>
                    <div class="item-main-req">
                        <img src="./img/ticket.png" alt="" class="icon-ticket">
                        <span>.00元(满300元)</span>
                    </div>
                    <a href="javascript:void(0);" class="item-main-btn js-rece" data-batchid="A007">获取专属券码</a>
                    <a href="javascript:void(0);" class="item-main-btn disabled led">已领取</a>
                </div>
                <div class="d-item-bot">
                    <span>有效时间:2018-01-12 12:20 - 2019-01-12 12:20</span>
                </div>
            </li>
            <li class="discount-coupon-item">
                <div class="d-item-top">
                    <div class="item-main-price">
                        <span>40</span>
                    </div>
                    <div class="item-main-req">
                        <img src="./img/ticket.png" alt="" class="icon-ticket">
                        <span>.00元(满200元)</span>
                    </div>
                    <a href="javascript:void(0);" class="item-main-btn js-rece" data-batchid="A002">获取专属券码</a>
                    <a href="javascript:void(0);" class="item-main-btn disabled led">已领取</a>
                </div>
                <div class="d-item-bot">
                    <span>有效时间:2018-01-12 12:20 - 2019-01-12 12:20</span>
                </div>
            </li>
            <li class="discount-coupon-item">
                <div class="d-item-top">
                    <div class="item-main-price">
                        <span>30</span>
                    </div>
                    <div class="item-main-req">
                        <img src="./img/ticket.png" alt="" class="icon-ticket">
                        <span>.00元(满100元)</span>
                    </div>
                    <a href="javascript:void(0);" class="item-main-btn js-rece" data-batchid="A001">获取专属券码</a>
                    <a href="javascript:void(0);" class="item-main-btn disabled led">已领取</a>
                </div>
                <div class="d-item-bot">
                    <span>有效时间:2018-01-12 12:20 - 2019-01-12 12:20</span>
                </div>
            </li>
            <li class="discount-coupon-item">
                <div class="d-item-top">
                    <div class="item-main-price">
                        <span>40</span>
                    </div>
                    <div class="item-main-req">
                        <img src="./img/ticket.png" alt="" class="icon-ticket">
                        <span>.00元(满200元)</span>
                    </div>
                    <a href="javascript:void(0);" class="item-main-btn js-rece" data-batchid="A002">获取专属券码</a>
                    <a href="javascript:void(0);" class="item-main-btn disabled led">已领取</a>
                </div>
                <div class="d-item-bot">
                    <span>有效时间:2018-01-12 12:20 - 2019-01-12 12:20</span>
                </div>
            </li>  -->
            <li class="discount-coupon-item">
                <div class="d-item-top">
                    <div class="item-main-price">
                        <span>20%</span>
                    </div>
                    <div class="item-main-req">
                        <img src="./img/ticket.png" alt="" class="icon-ticket">
                        <span>.00元(满100元最高200元)</span>
                    </div>
                    <a href="javascript:void(0);" class="item-main-btn js-rece" data-batchid="A011">获取专属券码</a>
                    <a href="javascript:void(0);" class="item-main-btn disabled led">已领取</a>
                </div>
                <div class="d-item-bot">
                    <span>有效时间:2019-01-25 00:00 - 2019-07-24 23:59</span>
                </div>
            </li>
        </ul>

        <div class="discount-feet">
            <span class="feet-title">加价券使用规则：</span>
            <ol class="feet-rules">
                <li>验机价满4000元，可领取300元加价券；验机价满2000元，可领取120元加价券；验机价满1000元，可领取60元加价券；验机价满500元，可领取50元加价券；验机价满100元，可领取10%加价券。</li>
                <li>加价券一键领取成功，自动发到用户账户，下单加价根据估价金额推荐最合适的加价券。</li>
                <li>加价券使用以实际验机价为准。</li>
                <li>若实际验机价格低于评估价格，使用加价券无效，则后台给用户匹配新的优惠券（加价券降档分配，直至符合满加活动规则）。</li>
                <li>实际验机价格出单后，加价券将自行匹配更新订单。</li>
                <li>加价券不可与其他活动叠加使用。</li>
                <li>活动声明：本活动最终解释权归M-超人所有。</li>
            </ol>
        </div>
    </div>
	
	<div id="add-price-ticket" class="add-price-ticket hide">
	  <div class="query-box">
		<div id="my-ticket-box" class="my-ticket-box">
		   <!--	<div class="tipinfo-box"><span>我的优惠券</span></div> -->
			<div class="input-item">
				<input id="phoneNum" type="text" placeholder="请输入手机号" />
			</div>
			<div class="input-item">
				<input id="codeNum" class="short-input" type="text" placeholder="请填写验证码" />
				<span id="getCodeBtn" class="input-label active-btn">获取验证码</span>
				<span id="secondLabel" class="input-label info-box">60秒</span>
			</div>
			<div class="input-item">
				<span id="queryBtn" class="query-btn">去领取</span>
			</div>
		</div>
	  </div>
    </div>


    <script src="js/jquery.js"></script>
    <script src="js/util.js"></script>
    <script>
        $(function(){
            window.G = window.G || {};
            G.HappyGoMobile = eCacheUtil.storage.getCache( CacheKey.HappyGoMobile );  //获得手机号
			
            $('#ticket-box').delegate( '.js-rece' , 'click' , function(){
                var self = $(this);
                var batchId = self.data( 'batchid' );           //当前优惠劵的批次号
                
               // G.HappyGoMobile='18106538281';
			    G.HappyGoMobile = eCacheUtil.storage.getCache( CacheKey.HappyGoMobile );  //获得手机号
				
                //判断是否有有效的手机号码
                if( ! (G.HappyGoMobile) ){
                    alert( '手机号码为空！' );
					
					$('#add-price-ticket').removeClass( 'hide' );
                    return ;
                }
                
                if( G.isPosting == true ){
                    return ;
                }
                G.isPosting = true ;
                
                
                //获取客户领取加价券
                var param = {
                    mobile: G.HappyGoMobile,
                    batchId: batchId
                };
                $.post(
                    linkUrl+'/recycle/receiveCoupons.do',
                    {
                        params:JSON.stringify(param)
                    },
                    function(data){
                        if(data.success){
                            if( data.resultCode == "0" ){
                                //已经领取
                                var parentBox = self.parent() ;
                                var ledBtn = parentBox.find( '.led' );
                                //隐藏当前的按钮，并显示'已领取'的按钮
                                self.attr( 'style' , 'display:none' );
                                ledBtn.attr( 'style' , 'display:block' );
                            }
                        }else{                      
                            if( data.resultCode == "1" ){
                                //已经领取
                                var parentBox = self.parent() ;
                                var ledBtn = parentBox.find( '.led' );
                                //隐藏当前的按钮，并显示'已领取'的按钮
                                self.attr( 'style' , 'display:none' );
                                ledBtn.attr( 'style' , 'display:block' );
                                
                                //提示已经领取过
                                alert( '您已经领取过该加价劵' );
                            }else if(data.resultCode == "2"){
                              alert( '该加价券已被领完,下次记得早点来哦!' );
                            }
                         }
                        G.isPosting = false ;
                    });
            }); //end of 响应按钮事件
			
		//a.获取验证码
		$('#getCodeBtn').click( function(){
			var phoneNum = $('#phoneNum').val();
			
			if( phoneNum === '' ){
				alert( '请先输入手机号' );
				$('#phoneNum').focus();
				return ;
			}
			
			if( G.isPosting ){
				return ;
			}
			G.isPosting = true ;

			//发送服务器请求
			var param = {
				"mobile":phoneNum
			}
			 $.post(
					 getRealPath()+"/wechat/sendSmsCode.do",
				{
					params:JSON.stringify(param)
				},
				function(data){
					if (data.success){
						//启动计数定时器
						startSecondCount();
						//设置发送验证码的状态
						$('#my-ticket-box').addClass( 'sending-code' );
					}else{
						alert(data.resultMessage);
					}
					G.isPosting = false ;
				});
		});
		
		//b. 开始倒计时
		function startSecondCount( ){
			G.secondValue = 60 ;
			$('#secondLabel').html( G.secondValue + '秒' );
			updateSecondCount();
		}
		function updateSecondCount( ){
			setTimeout( function(){
				G.secondValue = G.secondValue -1 ;
				if( G.secondValue > 0  ){
					$('#secondLabel').html( G.secondValue + '秒' );
					//调用自身
					updateSecondCount();
				}
				else{
					$('#my-ticket-box').removeClass( 'sending-code' );
				}
			},1000 );
			return ;
		}
		
		//c. 验证手机号
		$('#queryBtn').click( function(){
			var phoneNum = $('#phoneNum').val();
			var codeNum = $('#codeNum').val();

			if( phoneNum === '' ){	
				alert( '手机号不能为空' );
				$('#phoneNum').focus();
				return ;
			}
			
			if( codeNum === '' ){
				alert( '验证码不能为空' );
				$('#codeNum').focus();
				return ;
			}

			//向后台请求数据
			G.isPosting = true ;
			
			//a 登录
			var param = {
				"mobile":phoneNum,
				"checkCode":codeNum
			};
			$.post(
				getRealPath()+"/recycle/checkRandomCode.do",
				{
					params:JSON.stringify(param)
				},
				function(data){
					if ( data.success){
				     	eCacheUtil.storage.cache(CacheKey.HappyGoMobile,phoneNum);
					
					    //关闭选择框
				        $('#add-price-ticket').addClass( 'hide' );
					}else{
						alert(data.resultMessage);
					}
					
					G.isPosting = false ;
				});
		});		

        })
    </script>
</body>
</html>