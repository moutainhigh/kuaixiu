(function(a){a(function(){window.CT_Card=function(e){var o={backgroundColor:"rgba(210,210,210,1)",watermarkImg:null,waterOffsetX:-20,waterOffsetY:-20,maxCount:80};var b=a.extend(true,{},o,e);if(b.id===undefined){return}var t=a("#"+b.id);if(t.length===0){return}var q=t.width();var c=t.height();var m=document.createElement("canvas");m.width=q;m.height=c;t.append(m);var j=[];var d=m.getContext("2d");d.fillStyle=b.backgroundColor;var k=false;var g=null;var l=false;var r=t.offset().left;var p=t.offset().top;var f=0;var n=function(u){u.preventDefault();u.stopPropagation();l=true};var s=function(w){w.preventDefault();w.stopPropagation();if(l){var v=w.targetTouches?w.targetTouches[0]:w;var u=v.pageX||v.clientX+document.body.scrollLeft;var z=v.pageY||v.clientY+document.body.scrollTop;u=Math.ceil(u-r);z=Math.ceil(z-p);if(d){d.beginPath();d.arc(u,z,20,0,Math.PI*2);d.fill();f++}if(f>b.maxCount){t.removeClass("show").addClass("hide")}}};var i=function(u){u.preventDefault();u.stopPropagation();l=false};var h={};h.init=function(w){if(b.watermarkImg!==null){g=document.createElement("canvas");g.width=b.watermarkWidth||10;g.height=b.watermarkHeight||10;g.style.display="none";var u=g.getContext("2d");var v=new Image();v.onload=function(){var y=v.width;var x=v.height;b.watermarkWidth=b.watermarkWidth||y;b.watermarkHeight=b.watermarkHeight||x;u.drawImage(v,0,0,y,x,0,0,b.watermarkWidth,b.watermarkHeight);k=true;if(w&&typeof w==="function"){w()}};v.src=b.watermarkImg}if("ontouchstart" in document.documentElement){m.addEventListener("touchstart",n);m.addEventListener("touchend",i);m.addEventListener("touchmove",s)}else{m.addEventListener("mousedown",n);m.addEventListener("mouseup",i);m.addEventListener("mousemove",s)}return};h.reset=function(){d.clearRect(0,0,q,c);d.globalCompositeOperation="source-over";d.fillRect(0,0,q,c);if(k){var v=b.waterOffsetX;var u=b.waterOffsetY;while(v<m.width){while(u<m.height){d.drawImage(g,0,0,g.width,g.height,v,u,g.width,g.height);u=u+g.height}v=v+g.width;u=b.waterOffsetY}}f=0;d.globalCompositeOperation="destination-out";t.removeClass("hide").addClass("show");return true};return h}})})(jQuery);